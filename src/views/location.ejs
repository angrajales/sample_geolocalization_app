<!DOCTYPE html>
<html>
    <head>
        <title>P&aacute;gina Principal</title>
        <meta charset="utf-8">
        <% include helpers/head %>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
        integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
        crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>
        
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <a class="navbar-brand" href="/profile">Página Principal</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
                <ul class="navbar-nav">
                    <li class="nav-item active">
                        <a class="nav-link" href="/profile">Inicio <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <%= user.local.email %>
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <a class="dropdown-item" href="/logout">Cerrar Sesi&oacute;n</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
        <div id="mapid"></div>
        <% locs = JSON.parse(locations)%>
        <% var long = []; %>
        <% var lati = []; %>
        <% for(var i = 0; i < locs.length; i++){ %>
            <% long.push(locs[i]['longitude']) %>
            <% lati.push(locs[i]['latitude']) %>
        <% } %>
        <% console.log(long) %>
        <script type="text/javascript">
            var initLong = [];
            var initLati = [];
            var slong = "<%= long %>";
            var slati = "<%= lati %>";
            for(var i = 0; i < slong.split(",").length; ++i){
                initLong.push((slong.split(",")[i]));
            }
            for(var i = 0; i < slati.split(",").length; ++i){
                initLati.push(Number(slati.split(",")[i]));
            }
            var mymap = L.map('mapid');
            //alert(initLati);
            if(initLati.length > 0){
                mymap.setView([initLati[0], initLong[0]], 13);
            }
            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		        maxZoom: 18,
		        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			    '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			    'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		        id: 'mapbox.streets'
            }).addTo(mymap);
            for(var i = 0; i < initLati.length; ++i){
                var marker = L.marker([initLati[i], initLong[i]]).addTo(mymap);
            }
        </script>
        <h1 class="text-center" style="color: #FFFFFF;">Buenos dias <strong><%= user.local.fullName %></strong></h1>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>    
    </body>
</html>